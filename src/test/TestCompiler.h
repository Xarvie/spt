#pragma once
#include "TestRunner.h"

// =========================================================
// 1. 编译测试
// =========================================================

inline void registerCompilerTest(TestRunner &runner) {

  runner.addTest("Compiler test - shadowing",
                 R"(
        var f = function(int n) -> int {
            var f = function(int x) -> int {
                return 999;
            };
            return f(n - 1);
        };
        print(f(10));
    )",
                 "999");

  runner.addTest("Compiler test - Stack Overwrite",
                 R"(
        auto recursive = function(int a, int b) -> int {
            if (a <= 0) { return 0; }
            return recursive(a-1, b);
        };

        auto test = function() -> int {
            auto a = 0;
            auto b = 12345;
            a = recursive(10, 200);
            return b;
        };

        print(test());
    )",
                 "12345");

  runner.addTest("Compiler test - Slot test",
                 R"(
        auto f = function(int n) -> int {
            if (n <= 0) { return 0; }
f(0); f(0); f(0); f(0); f(0); f(0); f(0); f(0); f(0); f(0);
f(0); f(0); f(0); f(0); f(0); f(0); f(0); f(0); f(0); f(0);
f(0); f(0); f(0); f(0); f(0); f(0); f(0); f(0); f(0); f(0);
f(0); f(0); f(0); f(0); f(0); f(0); f(0); f(0); f(0); f(0);
f(0); f(0); f(0); f(0); f(0); f(0); f(0); f(0); f(0); f(0);
f(0); f(0); f(0); f(0); f(0); f(0); f(0); f(0); f(0); f(0);
f(0); f(0); f(0); f(0); f(0); f(0); f(0); f(0); f(0); f(0);
f(0); f(0); f(0); f(0); f(0); f(0); f(0); f(0); f(0); f(0);
f(0); f(0); f(0); f(0); f(0); f(0); f(0); f(0); f(0); f(0);
f(0); f(0); f(0); f(0); f(0); f(0); f(0); f(0); f(0); f(0);
f(0); f(0); f(0); f(0); f(0); f(0); f(0); f(0); f(0); f(0);
f(0); f(0); f(0); f(0); f(0); f(0); f(0); f(0); f(0); f(0);
f(0); f(0); f(0); f(0); f(0); f(0); f(0); f(0); f(0); f(0);
f(0); f(0); f(0); f(0); f(0); f(0); f(0); f(0); f(0); f(0);
f(0); f(0); f(0); f(0); f(0); f(0); f(0); f(0); f(0); f(0);
f(0); f(0); f(0); f(0); f(0); f(0); f(0); f(0); f(0); f(0);
f(0); f(0); f(0); f(0); f(0); f(0); f(0); f(0); f(0); f(0);
f(0); f(0); f(0); f(0); f(0); f(0); f(0); f(0); f(0); f(0);
f(0); f(0); f(0); f(0); f(0); f(0); f(0); f(0); f(0); f(0);
f(0); f(0); f(0); f(0); f(0); f(0); f(0); f(0); f(0); f(0);
f(0); f(0); f(0); f(0); f(0); f(0); f(0); f(0); f(0); f(0);
f(0); f(0); f(0); f(0); f(0); f(0); f(0); f(0); f(0); f(0);
f(0); f(0); f(0); f(0); f(0); f(0); f(0); f(0); f(0); f(0);
f(0); f(0); f(0); f(0); f(0); f(0); f(0); f(0); f(0); f(0);
f(0); f(0); f(0); f(0); f(0); f(0); f(0); f(0); f(0); f(0);
f(0); f(0); f(0); f(0); f(0); f(0); f(0); f(0); f(0); f(0);
f(0); f(0); f(0); f(0); f(0); f(0); f(0); f(0); f(0); f(0);
f(0); f(0); f(0); f(0); f(0); f(0); f(0); f(0); f(0); f(0);
f(0); f(0); f(0); f(0); f(0); f(0); f(0); f(0); f(0); f(0);
f(0); f(0); f(0); f(0); f(0); f(0); f(0); f(0); f(0); f(0);
f(0); f(0); f(0); f(0); f(0); f(0); f(0); f(0); f(0); f(0);
f(0); f(0); f(0); f(0); f(0); f(0); f(0); f(0); f(0); f(0);
f(0); f(0); f(0); f(0); f(0); f(0); f(0); f(0); f(0); f(0);
f(0); f(0); f(0); f(0); f(0); f(0); f(0); f(0); f(0); f(0);
f(0); f(0); f(0); f(0); f(0); f(0); f(0); f(0); f(0); f(0);
f(0); f(0); f(0); f(0); f(0); f(0); f(0); f(0); f(0); f(0);
f(0); f(0); f(0); f(0); f(0); f(0); f(0); f(0); f(0); f(0);
f(0); f(0); f(0); f(0); f(0); f(0); f(0); f(0); f(0); f(0);
f(0); f(0); f(0); f(0); f(0); f(0); f(0); f(0); f(0); f(0);
f(0); f(0); f(0); f(0); f(0); f(0); f(0); f(0); f(0); f(0);
            return f(n-1);
        };
        print(f(1));
    )",
                 "0");
}
